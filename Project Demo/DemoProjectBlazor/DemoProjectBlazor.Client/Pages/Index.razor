@page "/index"
@rendermode @(new InteractiveWebAssemblyRenderMode(prerender: false))
@inject HttpClient Http

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-..." crossorigin="anonymous" />

<PageTitle>Index</PageTitle>

@if (isDeleting)
{
	<div class="modal fade show" style="display:block;" tabindex="-1" role="dialog">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Xác nhận xóa sinh viên!!!</h5>
					<button @onclick="CancelDelete" type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<p>Bạn có chắc muốn xóa sinh viên này?</p>
				</div>
				<div class="modal-footer">
					<button @onclick="() => Delete()" type="button" class="btn btn-danger">Có</button>
					<button @onclick="CancelDelete" type="button" class="btn btn-secondary" data-dismiss="modal">Không</button>
				</div>
			</div>
		</div>
	</div>
}

@if (isDeletingSelected)
{
	<div class="modal fade show" style="display:block;" tabindex="-1" role="dialog">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Xác nhận xóa nhiều sinh viên</h5>
					<button @onclick="CancelDeleteSelected" type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<p>Bạn có chắc muốn xóa các sinh viên đã chọn?</p>
				</div>
				<div class="modal-footer">
					<button @onclick="ConfirmDeleteSelected" type="button" class="btn btn-danger">Có</button>
					<button @onclick="CancelDeleteSelected" type="button" class="btn btn-secondary" data-dismiss="modal">Không</button>
				</div>
			</div>
		</div>
	</div>
}

@if (isInfoPopupOpen)
{
	<div class="modal fade show" style="display:block;" tabindex="-1" role="dialog" aria-labelledby="infoModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="infoModalLabel">Thông Tin Chi Tiết</h5>
					<button type="button" class="close" @onclick="CloseInfoPopup" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					@if (selectedStudent != null)
					{
						<div class="row">
							<!-- Thông tin sinh viên -->
							<div class="col-md-4">
								<h6><strong><em>Thông Tin Sinh Viên</em></strong></h6>
								<p><strong>Mã số sinh viên:</strong> @selectedStudent.MaSoSv</p>
								<p><strong>Họ tên cựu sinh viên:</strong> @selectedStudent.HoTenCuuSv</p>
								<p><strong>Mã định danh:</strong> @selectedStudent.MaDinhDanh</p>
								<p><strong>Giới tính:</strong> @(selectedStudent.GioiTinh == "M" ? "Nam" : selectedStudent.GioiTinh == "F" ? "Nữ" : "Không xác định")</p>
							</div>

							<!-- Thông tin chi tiết -->
							<div class="col-md-4">
								<h6><strong><em>Thông Tin Chi Tiết</em></strong></h6>
								<p><strong>Số điện thoại:</strong> @selectedStudent.SoDienThoai</p>
								<p><strong>Địa chỉ liên hệ:</strong> @selectedStudent.DiaChiLienHe</p>
								<p><strong>Ngày sinh:</strong> @selectedStudent.NgaySinh</p>
								<p><strong>Email:</strong> @selectedStudent.Email</p>
							</div>

							<!-- Thông tin thêm -->
							<div class="col-md-4">
								<h6><strong><em>Thông Tin Thêm</em></strong></h6>
								<p><strong>Tham gia đoàn:</strong> @selectedStudent.ThamGiaDoan</p>
								<p><strong>Ngày vào đoàn:</strong> @selectedStudent.NgayVaoDoan?.ToString("dd/MM/yyyy")</p>
								<p><strong>Tham gia đảng:</strong> @selectedStudent.ThamGiaDang</p>
								<p><strong>Ngày vào đảng:</strong> @selectedStudent.NgayVaoDang?.ToString("dd/MM/yyyy")</p>
							</div>
						</div>
					}
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" @onclick="CloseInfoPopup">Đóng</button>
					<a href="edit/@(selectedStudent?.Id)" class="btn btn-primary"><i class="fas fa-pencil-alt"></i> Sửa</a>
				</div>
			</div>
		</div>
	</div>
}

<h2>
	<span style="margin-right: 5px;"><button class="button-search-hide" @onclick="ToggleSearchForm"><i class="fas fa-list"></i></button></span>Danh sách cựu sinh viên
</h2>

@if (isSearchFormOpen)
{
	<form method="get" action="Filter" @onsubmit="OnSearchAsync">
		<div class="filter-section">
			<div class="filter-column">
				<label class="dropdown-label">Giới Tính:</label>
				<select id="GioiTinh" @bind="selectedGender" class="form-control">
					<option value="">-- Chọn Giới Tính --</option>
					<option value="M">Nam</option>
					<option value="F">Nữ</option>
				</select>
			</div>

			<div class="filter-column">
				<label class="dropdown-label">Tìm kiếm:</label>
				<input type="text" @bind="searchQuery" class="form-control" placeholder="Nhập từ khóa tìm kiếm">
			</div>

			<div class="button-search-container">
				<button type="button" @onclick="OnSearchAsync" class="button-search">
					<i class="fas fa-search"></i><span style="margin-left: 5px;">Tìm kiếm</span>
				</button>
				<a href="create" class="button-search">
					<i class="fas fa-plus"></i><span style="margin-left: 5px;"> Thêm sinh viên</span>
				</a>
				<button type="button" @onclick="DeleteSelected" class="button-search" id="button-delete-selected">
					<i class="fas fa-trash"></i><span style="margin-left: 5px;"> Xóa đã chọn</span>
				</button>
			</div>
		</div>
	</form>
}

<table class="table">
	<tr>
		<th><input type="checkbox" id="selectAll" @onchange="ToggleSelectAll"></th>
		<th>Mã số sinh viên</th>
		<th>Họ tên cựu sinh viên</th>
		<th>Mã định danh</th>
		<th>Giới tính</th>
		<th>Số điện thoại</th>
		<th>Địa chỉ liên hệ</th>
		<th>Ngày sinh</th>
		<th>Chức năng</th>
	</tr>
	@foreach (var item in dsCuuSinhVien)
	{
		<tr>
			<td><input type="checkbox" @onchange="e => ToggleSelection(item.Id, e)" checked="@selectedIds.Contains(item.Id)"></td>
			<td>@item.MaSoSv</td>
			<td>@item.HoTenCuuSv</td>
			<td>@item.MaDinhDanh</td>
			<td>@(item.GioiTinh == "M" ? "Nam" : item.GioiTinh == "F" ? "Nữ" : "Không xác định")</td>
			<td>@item.SoDienThoai</td>
			<td>@item.DiaChiLienHe</td>
			<td>@item.NgaySinh</td>
			<td>
				<a href="edit/@item.Id" class="button"><i class="fas fa-pencil-alt"></i></a> |
				<button @onclick="() => ShowInfoPopup(item.Id)" class="button"><i class="fas fa-user"></i></button> |
				<button @onclick="() => ConfirmDelete(item.Id)" class="button delete-button">
					<i class="fas fa-trash"></i>
				</button>
			</td>
		</tr>
	}
</table>

<!-- Nút chuyển trang -->
@if (TotalPages > 1)
{
	<div class="pagination-container">
		<button @onclick="() => LoadPage(1)">&lt;&lt;</button>
		<button @onclick="() => LoadPage(CurrentPage - 1)">&lt;</button>
		@for (int i = 1; i <= TotalPages; i++)
		{
			<button @onclick="() => LoadPage(i)" class="@(i == CurrentPage ? "active" : "")">@i</button>
		}
		<button @onclick="() => LoadPage(CurrentPage + 1)">&gt;</button>
		<button @onclick="() => LoadPage(TotalPages)">&gt;&gt;</button>
	</div>
}
